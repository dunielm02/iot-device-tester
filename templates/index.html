<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/main.css">
    <title>Document</title>
</head>
<style>
    #messages {
        text-align: left;
    }
</style>
<body>
    <input id="url" name="url" type="hidden" value="ws://localhost:8000/ws">

    <div class="w-screen h-72 absolute top-0 left-0 bg-gradient-to-b from-blue-400 to-blue-500 -z-10"></div>

    <div class="xl:max-w-5xl md:max-w-3xl max-w-xs  mx-auto text-center text-white">
        <h1 class="text-3xl mt-10">Probar Dispositivos</h1>
        <p class="mt-3">Descripcion.....</p>
        <div class="flex bg-white rounded-md h-12 text-black max-w-md mx-auto mt-11">
            <label for="username" class="text-lg my-auto px-3">Usuario:</label>
            <input class="w-full focus:bg-gray-200 rounded-md" type="text" id="username" name="username" placeholder="Device 1">
        </di>
    </div>

    <div class="mt-4 transition-all duration-300" id="loginMessages">
    </div>

    <div id="messages" class="mt-4 transition-all duration-300 relative top-72">
    </div> 

    <script>
        let cant = 0;

        var wsUrl = document.getElementById('url').value

        var loginMessages = document.getElementById("loginMessages")
        var messages = document.getElementById("messages")
        var username = document.getElementById("username")

        var socket = new WebSocket(wsUrl)

        function deleteLoginMessage() {
            loginMessages.innerHTML = ''
        }
        function deleteMessage(id) {
            document.getElementById(`Message${id}`).remove();
        }

        socket.onmessage = function (msg) {
            data=JSON.parse(msg.data)
            window.data=data
            if(data.username === username.value){
                if(data.logged === true){
                    let aux = cant;
                    cant++;
                    messages.innerHTML = 
                    `<div id=\"Message${aux}\" class=\"text-center mt-4 bg-green-50 border-green-500 border-2 text-black rounded-md py-4 px-3\">\
                        <p><ID: ${data.codcli}> IAPOW: ${data.body.IAPOW}</p>\
                    </div>` + messages.innerHTML;
                    setTimeout( function () {
                        deleteMessage(aux);
                    }, 3000)
                }else if (data.logged === false) {
                    loginMessages.innerHTML = 
                    "<div class=\"text-center bg-yellow-50 border-yellow-300 border-2 text-black rounded-md py-4 px-3\">\
                        <p>Se ha logueado un nuevo Dispositivo</p>\
                    </div>"
                    setTimeout(deleteLoginMessage,3000)
                }
            }
        }
    </script>
</body>
</html>